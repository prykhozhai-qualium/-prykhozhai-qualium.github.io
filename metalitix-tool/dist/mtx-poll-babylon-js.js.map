{"version":3,"file":"mtx-poll-babylon-js.js","mappings":"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","sources":["webpack://MetalitixLogger/webpack/universalModuleDefinition","webpack://MetalitixLogger/webpack/bootstrap","webpack://MetalitixLogger/webpack/runtime/define property getters","webpack://MetalitixLogger/webpack/runtime/hasOwnProperty shorthand","webpack://MetalitixLogger/./node_modules/three/src/math/MathUtils.js","webpack://MetalitixLogger/./src/constants/index.ts","webpack://MetalitixLogger/./src/types/index.ts","webpack://MetalitixLogger/./src/utils/index.ts","webpack://MetalitixLogger/./src/lib/mtx-engagement-survey.ts","webpack://MetalitixLogger/./src/services/index.ts","webpack://MetalitixLogger/./src/lib/mtx-poll-base.ts","webpack://MetalitixLogger/./src/lib/mtx-poll-babylon-js.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"MetalitixLogger\"] = factory();\n\telse\n\t\troot[\"MetalitixLogger\"] = factory();\n})(self, () => {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const _lut = [];\n\nfor ( let i = 0; i < 256; i ++ ) {\n\n\t_lut[ i ] = ( i < 16 ? '0' : '' ) + ( i ).toString( 16 );\n\n}\n\nlet _seed = 1234567;\n\n\nconst DEG2RAD = Math.PI / 180;\nconst RAD2DEG = 180 / Math.PI;\n\n// http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript/21963136#21963136\nfunction generateUUID() {\n\n\tconst d0 = Math.random() * 0xffffffff | 0;\n\tconst d1 = Math.random() * 0xffffffff | 0;\n\tconst d2 = Math.random() * 0xffffffff | 0;\n\tconst d3 = Math.random() * 0xffffffff | 0;\n\tconst uuid = _lut[ d0 & 0xff ] + _lut[ d0 >> 8 & 0xff ] + _lut[ d0 >> 16 & 0xff ] + _lut[ d0 >> 24 & 0xff ] + '-' +\n\t\t\t_lut[ d1 & 0xff ] + _lut[ d1 >> 8 & 0xff ] + '-' + _lut[ d1 >> 16 & 0x0f | 0x40 ] + _lut[ d1 >> 24 & 0xff ] + '-' +\n\t\t\t_lut[ d2 & 0x3f | 0x80 ] + _lut[ d2 >> 8 & 0xff ] + '-' + _lut[ d2 >> 16 & 0xff ] + _lut[ d2 >> 24 & 0xff ] +\n\t\t\t_lut[ d3 & 0xff ] + _lut[ d3 >> 8 & 0xff ] + _lut[ d3 >> 16 & 0xff ] + _lut[ d3 >> 24 & 0xff ];\n\n\t// .toUpperCase() here flattens concatenated strings to save heap memory space.\n\treturn uuid.toUpperCase();\n\n}\n\nfunction clamp( value, min, max ) {\n\n\treturn Math.max( min, Math.min( max, value ) );\n\n}\n\n// compute euclidian modulo of m % n\n// https://en.wikipedia.org/wiki/Modulo_operation\nfunction euclideanModulo( n, m ) {\n\n\treturn ( ( n % m ) + m ) % m;\n\n}\n\n// Linear mapping from range <a1, a2> to range <b1, b2>\nfunction mapLinear( x, a1, a2, b1, b2 ) {\n\n\treturn b1 + ( x - a1 ) * ( b2 - b1 ) / ( a2 - a1 );\n\n}\n\n// https://www.gamedev.net/tutorials/programming/general-and-gameplay-programming/inverse-lerp-a-super-useful-yet-often-overlooked-function-r5230/\nfunction inverseLerp( x, y, value ) {\n\n\tif ( x !== y ) {\n\n\t\treturn ( value - x ) / ( y - x );\n\n\t} else {\n\n\t\treturn 0;\n\n\t}\n\n}\n\n// https://en.wikipedia.org/wiki/Linear_interpolation\nfunction lerp( x, y, t ) {\n\n\treturn ( 1 - t ) * x + t * y;\n\n}\n\n// http://www.rorydriscoll.com/2016/03/07/frame-rate-independent-damping-using-lerp/\nfunction damp( x, y, lambda, dt ) {\n\n\treturn lerp( x, y, 1 - Math.exp( - lambda * dt ) );\n\n}\n\n// https://www.desmos.com/calculator/vcsjnyz7x4\nfunction pingpong( x, length = 1 ) {\n\n\treturn length - Math.abs( euclideanModulo( x, length * 2 ) - length );\n\n}\n\n// http://en.wikipedia.org/wiki/Smoothstep\nfunction smoothstep( x, min, max ) {\n\n\tif ( x <= min ) return 0;\n\tif ( x >= max ) return 1;\n\n\tx = ( x - min ) / ( max - min );\n\n\treturn x * x * ( 3 - 2 * x );\n\n}\n\nfunction smootherstep( x, min, max ) {\n\n\tif ( x <= min ) return 0;\n\tif ( x >= max ) return 1;\n\n\tx = ( x - min ) / ( max - min );\n\n\treturn x * x * x * ( x * ( x * 6 - 15 ) + 10 );\n\n}\n\n// Random integer from <low, high> interval\nfunction randInt( low, high ) {\n\n\treturn low + Math.floor( Math.random() * ( high - low + 1 ) );\n\n}\n\n// Random float from <low, high> interval\nfunction randFloat( low, high ) {\n\n\treturn low + Math.random() * ( high - low );\n\n}\n\n// Random float from <-range/2, range/2> interval\nfunction randFloatSpread( range ) {\n\n\treturn range * ( 0.5 - Math.random() );\n\n}\n\n// Deterministic pseudo-random float in the interval [ 0, 1 ]\nfunction seededRandom( s ) {\n\n\tif ( s !== undefined ) _seed = s % 2147483647;\n\n\t// Park-Miller algorithm\n\n\t_seed = _seed * 16807 % 2147483647;\n\n\treturn ( _seed - 1 ) / 2147483646;\n\n}\n\nfunction degToRad( degrees ) {\n\n\treturn degrees * DEG2RAD;\n\n}\n\nfunction radToDeg( radians ) {\n\n\treturn radians * RAD2DEG;\n\n}\n\nfunction isPowerOfTwo( value ) {\n\n\treturn ( value & ( value - 1 ) ) === 0 && value !== 0;\n\n}\n\nfunction ceilPowerOfTwo( value ) {\n\n\treturn Math.pow( 2, Math.ceil( Math.log( value ) / Math.LN2 ) );\n\n}\n\nfunction floorPowerOfTwo( value ) {\n\n\treturn Math.pow( 2, Math.floor( Math.log( value ) / Math.LN2 ) );\n\n}\n\nfunction setQuaternionFromProperEuler( q, a, b, c, order ) {\n\n\t// Intrinsic Proper Euler Angles - see https://en.wikipedia.org/wiki/Euler_angles\n\n\t// rotations are applied to the axes in the order specified by 'order'\n\t// rotation by angle 'a' is applied first, then by angle 'b', then by angle 'c'\n\t// angles are in radians\n\n\tconst cos = Math.cos;\n\tconst sin = Math.sin;\n\n\tconst c2 = cos( b / 2 );\n\tconst s2 = sin( b / 2 );\n\n\tconst c13 = cos( ( a + c ) / 2 );\n\tconst s13 = sin( ( a + c ) / 2 );\n\n\tconst c1_3 = cos( ( a - c ) / 2 );\n\tconst s1_3 = sin( ( a - c ) / 2 );\n\n\tconst c3_1 = cos( ( c - a ) / 2 );\n\tconst s3_1 = sin( ( c - a ) / 2 );\n\n\tswitch ( order ) {\n\n\t\tcase 'XYX':\n\t\t\tq.set( c2 * s13, s2 * c1_3, s2 * s1_3, c2 * c13 );\n\t\t\tbreak;\n\n\t\tcase 'YZY':\n\t\t\tq.set( s2 * s1_3, c2 * s13, s2 * c1_3, c2 * c13 );\n\t\t\tbreak;\n\n\t\tcase 'ZXZ':\n\t\t\tq.set( s2 * c1_3, s2 * s1_3, c2 * s13, c2 * c13 );\n\t\t\tbreak;\n\n\t\tcase 'XZX':\n\t\t\tq.set( c2 * s13, s2 * s3_1, s2 * c3_1, c2 * c13 );\n\t\t\tbreak;\n\n\t\tcase 'YXY':\n\t\t\tq.set( s2 * c3_1, c2 * s13, s2 * s3_1, c2 * c13 );\n\t\t\tbreak;\n\n\t\tcase 'ZYZ':\n\t\t\tq.set( s2 * s3_1, s2 * c3_1, c2 * s13, c2 * c13 );\n\t\t\tbreak;\n\n\t\tdefault:\n\t\t\tconsole.warn( 'THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: ' + order );\n\n\t}\n\n}\n\n\n\n\nexport {\n\tDEG2RAD,\n\tRAD2DEG,\n\tgenerateUUID,\n\tclamp,\n\teuclideanModulo,\n\tmapLinear,\n\tinverseLerp,\n\tlerp,\n\tdamp,\n\tpingpong,\n\tsmoothstep,\n\tsmootherstep,\n\trandInt,\n\trandFloat,\n\trandFloatSpread,\n\tseededRandom,\n\tdegToRad,\n\tradToDeg,\n\tisPowerOfTwo,\n\tceilPowerOfTwo,\n\tfloorPowerOfTwo,\n\tsetQuaternionFromProperEuler,\n};\n","export const isProduction = process.env.NODE_ENV === 'production';\nexport const isStaging = process.env.NODE_ENV === 'staging';\nexport const API_ORIGIN = isProduction\n  ? 'https://app.metalitix.com'\n  : isStaging\n  ? 'https://metalitix-staging.aircards.io'\n  : 'https://metalitix-dev.aircards.io';\nexport const API_VERSION = 'v1';\nexport const API_URL = `${API_ORIGIN}/api/${API_VERSION}`;\n\nexport const MIN_INTERVAL_VALUE = 100;\nexport const MAX_INTERVAL_VALUE = 1000;\nexport const DEFAULT_INTERVAL_VALUE = 500;\n\nexport const MAXIMUM_BATCH_RECORDS_LENGTH = 100;\n/** Wait maximum 3 minutes if limit of MAXIMUM_BATCH_RECORDS_LENGTH was not reached */\nexport const MAXIMUM_BATCH_SENDING_INTERVAL = 3 * 60 * 1000;\n/** Maximum server keepalive time since last successful pull data to the server */\nexport const MAXIMUM_SESSION_KEEPALIVE_TIME = 5 * 60 * 1000;\n","export interface MetalitixLoggerOptions {\n  pollInterval?: number;\n  apiVersion?: string;\n  userMeta?: Partial<XRAnalytics.UserMetadata>;\n  showSurvey?: boolean;\n  surveyTheme?: SurveyTheme;\n}\n\nexport type SurveyTheme = 'white' | 'black';\n\nexport interface AddSurveyProps {\n  appkey: string;\n  sessionId: string;\n  /** If user trigger the survey manually - it will always show the survey popup even if user already submitted it once */\n  force?: boolean;\n  theme?: SurveyTheme;\n}\n\nexport interface MetricSurveysData {\n  sessionId: string;\n  appkey: string;\n  rating: number;\n}\n\nexport interface Vector2D {\n  x: number;\n  y: number;\n}\n\nexport interface Vector3D {\n  x: number;\n  y: number;\n  z: number;\n}\n\nexport namespace XRAnalytics {\n  export enum PointStates {\n    Pressed = 'state.pressed',\n    Updated = 'state.updated',\n    Released = 'state.released',\n    Stationary = 'state.stationary',\n  }\n\n  export const KnownPointStates = Object.values(PointStates);\n\n  export enum UserInteractionTypes {\n    KeyDown = 'user.interaction.key_down',\n    KeyPress = 'user.interaction.key_press',\n    KeyUp = 'user.interaction.key_down',\n    MouseEnter = 'user.interaction.mouse_enter',\n    MouseLeave = 'user.interaction.mouse_leave',\n    MouseOver = 'user.interaction.mouse_over',\n    MouseOut = 'user.interaction.mouse_out',\n    MouseDown = 'user.interaction.mouse_down',\n    MouseUp = 'user.interaction.mouse_up',\n    MouseMove = 'user.interaction.mouse_move',\n    MousePress = 'user.interaction.mouse_press',\n    TouchTap = 'user.interaction.touch_tap',\n    TouchStart = 'user.interaction.touch_start',\n    TouchMove = 'user.interaction.touch_move',\n    TouchEnd = 'user.interaction.touch_end',\n    ZoomStart = 'user.interaction.zoom_start',\n    ZoomUpdate = 'user.interaction.zoom_update',\n    ZoomEnd = 'user.interaction.zoom_end',\n  }\n\n  export const KnownUserInteractionTypes = Object.values(UserInteractionTypes);\n\n  /**\n   * XR Analytic Log Record Event Point\n   * - describes event point params\n   * @typedef {object} XRAnalyticEventPoint\n   * @property {string} state - point state\n   * @property {number} timestamp - timestamp in msec or ISO string\n   * @property {oneOf|Vector2D|Vector3D} timestamp - timestamp in msec or ISO string\n   */\n  export interface EventPoint {\n    state: PointStates;\n    timestamp: number;\n    position: Vector2D | Vector3D;\n  }\n\n  /**\n   * XR Analytic Log Record User Event\n   * - describes user events params\n   * @typedef {object} XRAnalyticUserEvent\n   * @property {string} object - `user.event`\n   * @property {string} eventName - human-readable event name\n   * @property {string} eventType - event type identifier\n   * @property {string} target - optional field which describes target of this event\n   * @property {array<XRAnalyticEventPoint>} points - multiple points (for multi-touch) or single point\n   * @property {object} params - any additional params\n   */\n  export interface UserEvent {\n    object: string;\n    eventName: string;\n    eventType: UserInteractionTypes | string;\n    target?: string | EventPoint | any;\n    points?: EventPoint[];\n    params?: object;\n  }\n\n  export enum EventTypes {\n    UserPosition = 'event.user.position',\n    UserInteraction = 'event.user.interaction',\n    SessionStart = 'event.session.start',\n    SessionUpdate = 'event.session.update',\n    SessionEnd = 'event.session.end',\n  }\n\n  export const KnownEventTypes = Object.values(EventTypes);\n\n  /**\n   * XR Analytic Log Record User Camera\n   * - describes user camera params\n   * @typedef {object} XRAnalyticUserCamera\n   * @property {number} fieldOfView\n   * @property {number} aspectRatio\n   * @property {number} zNearPlane\n   * @property {number} zFarPlane\n   */\n  export interface UserCamera {\n    fieldOfView: number;\n    aspectRatio: number;\n    zNearPlane: number;\n    zFarPlane: number;\n  }\n\n  /**\n   * XR Analytic Log Record User Metadata\n   * - can contain different fields related to user client.\n   * These list of fields is approximate and all fields are optional.\n   * @typedef {object} XRAnalyticUserMetadata\n   * @property {string} ipAddress - user ip address\n   * @property {string} geolocation - user geolocation\n   * @property {string} userAgent - user client user-agent string\n   * @property {string} pagePath - current page\n   * @property {string} pageQuery - current query params\n   * @property {string} sceneName - current scene name\n   * @property {string} gameLocation - current map / in-game location\n   * @property {object} systemInfo - free dictionary of sys info (like OS ver or etc.)\n   * @property {object} params - any additional params\n   */\n  export interface UserMetadata {\n    ipAddress: string;\n    geolocation: string;\n    userAgent: string;\n    pagePath: string;\n    pageQuery: string;\n    sceneName: string;\n    gameLocation: string;\n    systemInfo: object;\n    params: object;\n  }\n\n  /**\n   * XR Analytic Log Record User Position\n   * - contain position, direction and optionally any additional custom fields\n   * @typedef {object} XRAnalyticRecordData\n   * @property {Vector3D} position - user position\n   * @property {Vector3D} direction - look at direction\n   */\n  export interface Data {\n    position: Vector3D;\n    direction: Vector3D;\n    [k: string]: any;\n  }\n\n  /**\n   * XR Analytic Log RecordBase\n   * @typedef {object} XRAnalyticRecord\n   * @property {string} appkey - project API key\n   * @property {string} apiver - expected to be `'v2'`\n   * @property {string} sessionId - session uuid\n   * @property {number} timestamp - timestamp in msec or ISO string date\n   * @property {XRAnalyticRecordData} data - user position and direction on the scene. Can contain any additional custom fields.\n   */\n  export interface RecordBase {\n    object: string;\n    sessionId: string;\n    timestamp: number;\n    appkey: string;\n    apiver: string;\n    metrics: {\n      fps: number;\n    };\n    data: Data;\n  }\n\n  /**\n   * XR Analytic Log RecordDataFields\n   * @typedef {object} XRAnalyticRecord\n   * @property {XRAnalyticRecordData} data - user position and direction on the scene. Can contain any additional custom fields.\n   * @property {XRAnalyticUserMetadata} userMeta - field describing client metadata, actual for `event.user.session.start` and `event.user.session.update` events\n   * @property {XRAnalyticUserCamera} camera - field describing user camera, actual for `event.user.session.start` and `event.user.session.update` events\n   * @property {XRAnalyticUserEvent} userEvent - field describing event, actual for `event.user.interaction` events\n   */\n  export interface RecordDataFields {\n    data: Data;\n    userMeta?: Partial<UserMetadata>;\n    camera?: UserCamera;\n    userEvent?: UserEvent;\n  }\n\n  /**\n   * XR Analytic Log SessionStartRecord\n   * @typedef {object} XRAnalyticRecord\n   * @property {string} eventType - EventTypes.SessionStart event type\n   * @property {string} appkey - project API key\n   * @property {string} apiver - expected to be `'v2'`\n   * @property {string} sessionId - session uuid\n   * @property {number} timestamp - timestamp in msec or ISO string date\n   * @property {XRAnalyticUserMetadata} userMeta - required field describing client metadata, actual for `event.user.session.start` and `event.user.session.update` events\n   * @property {XRAnalyticUserCamera} camera - required field describing user camera, actual for `event.user.session.start` and `event.user.session.update` events\n   * @property {XRAnalyticRecordData} data - user position and direction on the scene. Can contain any additional custom fields.\n   */\n  export interface SessionStartRecord extends RecordBase {\n    eventType: EventTypes.SessionStart;\n    userMeta: Partial<UserMetadata>;\n    camera: UserCamera;\n  }\n\n  /**\n   * XR Analytic Log SessionUpdateRecord\n   * @typedef {object} XRAnalyticRecord\n   * @property {string} eventType - EventTypes.SessionUpdate event type\n   * @property {string} appkey - project API key\n   * @property {string} apiver - expected to be `'v2'`\n   * @property {string} sessionId - session uuid\n   * @property {number} timestamp - timestamp in msec or ISO string date\n   * @property {XRAnalyticUserMetadata} userMeta - required field describing client metadata, actual for `event.user.session.start` and `event.user.session.update` events\n   * @property {XRAnalyticUserCamera} camera - optional field describing user camera, actual for `event.user.session.start` and `event.user.session.update` events\n   * @property {XRAnalyticRecordData} data - user position and direction on the scene. Can contain any additional custom fields.\n   */\n  export interface SessionUpdateRecord extends RecordBase {\n    eventType: EventTypes.SessionUpdate;\n    userMeta: Partial<UserMetadata>;\n    camera?: UserCamera;\n  }\n\n  /**\n   * XR Analytic Log SessionEndRecord\n   * @typedef {object} XRAnalyticRecord\n   * @property {string} eventType - EventTypes.SessionEnd event type\n   * @property {string} appkey - project API key\n   * @property {string} apiver - expected to be `'v2'`\n   * @property {string} sessionId - session uuid\n   * @property {number} timestamp - timestamp in msec or ISO string date\n   * @property {XRAnalyticUserCamera} camera - optional field describing user camera, actual for `event.user.session.start` and `event.user.session.update` events\n   * @property {XRAnalyticRecordData} data - user position and direction on the scene. Can contain any additional custom fields.\n   */\n  export interface SessionEndRecord extends RecordBase {\n    eventType: EventTypes.SessionEnd;\n    camera?: UserCamera;\n  }\n\n  /**\n   * XR Analytic Log UserPositionRecord\n   * @typedef {object} XRAnalyticRecord\n   * @property {string} eventType - EventTypes.UserPosition event type\n   * @property {string} appkey - project API key\n   * @property {string} apiver - expected to be `'v2'`\n   * @property {string} sessionId - session uuid\n   * @property {number} timestamp - timestamp in msec or ISO string date\n   * @property {XRAnalyticRecordData} data - user position and direction on the scene. Can contain any additional custom fields.\n   */\n  export interface UserPositionRecord extends RecordBase {\n    eventType: EventTypes.UserPosition;\n  }\n\n  /**\n   * XR Analytic Log UserInteractionRecord\n   * @typedef {object} XRAnalyticRecord\n   * @property {string} eventType - EventTypes.UserPosition event type\n   * @property {string} appkey - project API key\n   * @property {string} apiver - expected to be `'v2'`\n   * @property {string} sessionId - session uuid\n   * @property {number} timestamp - timestamp in msec or ISO string date\n   * @property {XRAnalyticUserEvent} userEvent - required field describing event, actual for `event.user.interaction` events\n   * @property {XRAnalyticRecordData} data - user position and direction on the scene. Can contain any additional custom fields.\n   */\n  export interface UserInteractionRecord extends RecordBase {\n    eventType: EventTypes.UserInteraction;\n    userEvent: UserEvent;\n  }\n\n  /**\n   * XR Analytic Log Record\n   * @typedef {object} XRAnalyticRecord\n   * @property {string} eventType - supported event types\n   * @property {string} appkey - project API key\n   * @property {string} apiver - expected to be `'v2'`\n   * @property {string} sessionId - session uuid\n   * @property {number} timestamp - timestamp in msec or ISO string date\n   * @property {XRAnalyticUserEvent} userEvent - field describing event, actual for `event.user.interaction` events\n   * @property {XRAnalyticUserMetadata} userMeta - field describing client metadata, actual for `event.user.session.start` and `event.user.session.update` events\n   * @property {XRAnalyticUserCamera} camera - field describing user camera, actual for `event.user.session.start` and `event.user.session.update` events\n   * @property {XRAnalyticRecordData} data - user position and direction on the scene. Can contain any additional custom fields.\n   */\n  export type Record =\n    | SessionStartRecord\n    | SessionUpdateRecord\n    | SessionEndRecord\n    | UserPositionRecord\n    | UserInteractionRecord;\n\n  /**\n   * XR Analytic Log Batch Records\n   * @typedef {object} XRAnalyticBatchRecord\n   * @property {string} appkey - project API key\n   * @property {string} apiver - expected to be `'v2'`\n   * @property {array<XRAnalyticRecord>} items - array of individual events\n   */\n  export interface BatchRecord {\n    object: string;\n    appkey: string;\n    apiver: string;\n    items: Record[];\n  }\n}\n","export function deepEqual(x: any, y: any): boolean {\n  const ok = Object.keys;\n  const tx = typeof x;\n  const ty = typeof y;\n\n  return x && y && tx === 'object' && tx === ty ? ok(x).length === ok(y).length && ok(x).every(key => deepEqual(x[key], y[key])) : x === y;\n}\n\nexport function isObject(item: any): item is Object {\n  return item && typeof item === 'object' && !Array.isArray(item);\n}\n\nexport function mergeDeep(target: any, source: any) {\n  let output = Object.assign({}, target);\n  if (isObject(target) && isObject(source)) {\n    Object.keys(source).forEach(key => {\n      if (isObject(source[key])) {\n        if (!(key in target)) Object.assign(output, { [key]: source[key] });\n        else output[key] = mergeDeep(target[key], source[key]);\n      } else {\n        Object.assign(output, { [key]: source[key] });\n      }\n    });\n  }\n  return output;\n}\n","import { sendMetricSurveysData } from '../services';\nimport { AddSurveyProps } from '../types';\n\nconst template = `<style>\n  .mtx-survey {\n    position: fixed;\n    z-index: 2000;\n    top: 0;\n    left: 50%;\n    transform: translate(-50%, -100%);\n    padding: 10px 33px 7px;\n    border-radius: 5px;\n    border: 2px solid #888;\n    transition: transform 0.3s ease-in-out;\n  }\n  \n  .mtx-survey--open {\n    transform: translate(-50%, 35px);\n  }\n  \n  .mtx-survey--close {\n    opacity: 0;\n    transition: transform 0.3s cubic-bezier(.84,-0.23,.41,.78), opacity 0.3s ease-in-out;\n    transform: translate(-50%, 0) scale(0.6);\n  }\n  \n  .mtx-survey--white {\n    background: #fff;\n    color: #292929;\n  }\n  \n  .mtx-survey--black {\n    background: #2d2d2d;\n    color: #fff;\n  }\n  \n  .mtx-survey-title {\n    font-family: 'Rubik', sans-serif;\n    font-style: normal;\n    font-weight: 400;\n    font-size: 14px;\n    line-height: 17px;\n    margin: 0 0 5px;\n    text-align: center;\n  }\n  \n  .mtx-survey-items {\n    text-align: center;\n    margin-bottom: 7px;\n  }\n  \n  .mtx-survey-item {\n    transition: opacity 0.3s ease-in-out;\n    cursor: pointer;\n  }\n  \n  .mtx-survey-submit-holder {\n    text-align: center;\n  }\n  \n  .mtx-survey-submit-button {\n    background: #FFFFFF;\n    border: 0;\n    font-family: 'Rubik', sans-serif;\n    font-style: normal;\n    font-weight: 300;\n    font-size: 10px;\n    line-height: 12px;\n    padding: 7px 27px;\n    border-radius: 5px;\n    cursor: pointer;\n  }\n  \n  .mtx-survey-submit-button:disabled {\n    opacity: 0.6;\n    cursor: not-allowed;\n  }\n  \n  .mtx-survey--white .mtx-survey-submit-button {\n    background: #292929;\n    color: #fff;\n  }\n  \n  .mtx-survey--black .mtx-survey-submit-button {\n    background: #fff;\n    color: #2f2f2f;\n  }\n</style>\n<h4 class=\"mtx-survey-title\">How would you rate your experience?</h4>\n<div class=\"mtx-survey-items\">\n  <svg width=\"265\" height=\"39\" viewBox=\"0 0 265 39\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n    <g class=\"mtx-survey-item\" data-value=\"1\">\n      <path d=\"M19.2562 37.805C29.2646 37.805 37.3965 29.6731 37.3965 19.6647C37.3965 9.65626 29.2646 1.52441 19.2562 1.52441C9.24777 1.52441 1.11594 9.65626 1.11594 19.6647C1.11594 29.6731 9.24777 37.805 19.2562 37.805Z\" fill=\"#E64355\"/>\n      <path d=\"M19.2564 2.64125C9.87348 2.64125 2.23313 10.2816 2.23313 19.6645C2.23313 29.0474 9.87348 36.6878 19.2564 36.6878C28.6393 36.6878 36.2796 29.0474 36.2796 19.6645C36.2796 10.2816 28.6393 2.64125 19.2564 2.64125ZM19.2564 0.407227C29.8903 0.407227 38.5137 9.03056 38.5137 19.6645C38.5137 30.2985 29.8903 38.9218 19.2564 38.9218C8.62242 38.9218 -0.000896454 30.2985 -0.000896454 19.6645C-0.000896454 9.03056 8.62242 0.407227 19.2564 0.407227Z\" fill=\"#FBD2D8\"/>\n      <path d=\"M23.6645 16.6417C22.7597 16.6417 22.0262 15.5414 22.0262 14.1842C22.0262 12.827 22.7597 11.7268 23.6645 11.7268C24.5693 11.7268 25.3027 12.827 25.3027 14.1842C25.3027 15.5414 24.5693 16.6417 23.6645 16.6417Z\" fill=\"white\"/>\n      <path d=\"M15.1 16.6417C14.1952 16.6417 13.4617 15.5414 13.4617 14.1842C13.4617 12.827 14.1952 11.7268 15.1 11.7268C16.0048 11.7268 16.7383 12.827 16.7383 14.1842C16.7383 15.5414 16.0048 16.6417 15.1 16.6417Z\" fill=\"white\"/>\n      <path d=\"M9.96176 28.2436C9.96176 28.2436 11.7639 21.5713 19.0021 21.5713C25.734 21.5713 28.5488 28.2436 28.5488 28.2436\" stroke=\"white\" stroke-width=\"1.5\" stroke-miterlimit=\"10\" stroke-linecap=\"round\"/>\n    </g>\n   \n    <g class=\"mtx-survey-item\" data-value=\"2\">\n      <path d=\"M75.7699 37.8047C85.7783 37.8047 93.9102 29.6729 93.9102 19.6644C93.9102 9.65602 85.7783 1.52417 75.7699 1.52417C65.7615 1.52417 57.6296 9.65602 57.6296 19.6644C57.6296 29.6729 65.7615 37.8047 75.7699 37.8047Z\" fill=\"#F5A720\"/>\n      <path d=\"M75.7701 2.64125C66.3872 2.64125 58.7468 10.2816 58.7468 19.6645C58.7468 29.0474 66.3872 36.6878 75.7701 36.6878C85.153 36.6878 92.7933 29.0474 92.7933 19.6645C92.7933 10.2816 85.153 2.64125 75.7701 2.64125ZM75.7701 0.407227C86.404 0.407227 95.0273 9.03056 95.0273 19.6645C95.0273 30.2985 86.404 38.9218 75.7701 38.9218C65.1361 38.9218 56.5128 30.2985 56.5128 19.6645C56.5128 9.03056 65.1361 0.407227 75.7701 0.407227Z\" fill=\"#FFE6BE\"/>\n      <path d=\"M80.0609 16.6413C79.1561 16.6413 78.4227 15.5411 78.4227 14.1839C78.4227 12.8267 79.1561 11.7264 80.0609 11.7264C80.9657 11.7264 81.6992 12.8267 81.6992 14.1839C81.6992 15.5411 80.9657 16.6413 80.0609 16.6413Z\" fill=\"white\"/>\n      <path d=\"M71.4848 16.6413C70.58 16.6413 69.8465 15.5411 69.8465 14.1839C69.8465 12.8267 70.58 11.7264 71.4848 11.7264C72.3896 11.7264 73.123 12.8267 73.123 14.1839C73.123 15.5411 72.3896 16.6413 71.4848 16.6413Z\" fill=\"white\"/>\n      <path d=\"M67.7444 27.484C67.7444 27.484 69.4124 23.6266 76.0996 23.6266C81.1038 23.6266 83.8145 27.484 83.8145 27.484\" stroke=\"white\" stroke-width=\"1.5\" stroke-miterlimit=\"10\" stroke-linecap=\"round\"/>\n    </g>\n   \n    <g class=\"mtx-survey-item\" data-value=\"3\">\n      <path d=\"M132.284 37.805C142.292 37.805 150.424 29.6731 150.424 19.6647C150.424 9.65626 142.292 1.52441 132.284 1.52441C122.275 1.52441 114.143 9.65626 114.143 19.6647C114.143 29.6731 122.275 37.805 132.284 37.805Z\" fill=\"#D4C828\"/>\n      <path d=\"M132.284 2.64125C122.901 2.64125 115.26 10.2816 115.26 19.6645C115.26 29.0474 122.901 36.6878 132.284 36.6878C141.667 36.6878 149.307 29.0474 149.307 19.6645C149.307 10.2816 141.667 2.64125 132.284 2.64125ZM132.284 0.407227C142.918 0.407227 151.541 9.03056 151.541 19.6645C151.541 30.2985 142.918 38.9218 132.284 38.9218C121.65 38.9218 113.026 30.2985 113.026 19.6645C113.026 9.03056 121.65 0.407227 132.284 0.407227Z\" fill=\"#F9F297\"/>\n      <path d=\"M136.551 17.49C135.646 17.49 134.913 16.3898 134.913 15.0326C134.913 13.6754 135.646 12.5752 136.551 12.5752C137.456 12.5752 138.189 13.6754 138.189 15.0326C138.189 16.3898 137.456 17.49 136.551 17.49Z\" fill=\"white\"/>\n      <path d=\"M127.989 17.49C127.084 17.49 126.35 16.3898 126.35 15.0326C126.35 13.6754 127.084 12.5752 127.989 12.5752C128.893 12.5752 129.627 13.6754 129.627 15.0326C129.627 16.3898 128.893 17.49 127.989 17.49Z\" fill=\"white\"/>\n      <path d=\"M138.416 25.5475H131.967C126.963 25.5475 126.054 25.5475 126.054 25.5475\" stroke=\"white\" stroke-width=\"1.5\" stroke-miterlimit=\"10\" stroke-linecap=\"round\"/>\n    </g>\n    \n    <g class=\"mtx-survey-item\" data-value=\"4\">\n      <path d=\"M188.797 37.805C198.806 37.805 206.938 29.6731 206.938 19.6647C206.938 9.65626 198.806 1.52441 188.797 1.52441C178.789 1.52441 170.657 9.65626 170.657 19.6647C170.657 29.6731 178.789 37.805 188.797 37.805Z\" fill=\"#A5CE3A\"/>\n      <path d=\"M188.797 2.64125C179.415 2.64125 171.774 10.2816 171.774 19.6645C171.774 29.0474 179.415 36.6878 188.797 36.6878C198.18 36.6878 205.821 29.0474 205.821 19.6645C205.821 10.2816 198.18 2.64125 188.797 2.64125ZM188.797 0.407227C199.431 0.407227 208.055 9.03056 208.055 19.6645C208.055 30.2985 199.431 38.9218 188.797 38.9218C178.163 38.9218 169.54 30.2985 169.54 19.6645C169.54 9.03056 178.163 0.407227 188.797 0.407227Z\" fill=\"#D7E48A\"/>\n      <path d=\"M193.09 17.4898C192.185 17.4898 191.452 16.3896 191.452 15.0324C191.452 13.6752 192.185 12.575 193.09 12.575C193.995 12.575 194.729 13.6752 194.729 15.0324C194.729 16.3896 193.995 17.4898 193.09 17.4898Z\" fill=\"white\"/>\n      <path d=\"M184.512 17.4898C183.607 17.4898 182.874 16.3896 182.874 15.0324C182.874 13.6752 183.607 12.575 184.512 12.575C185.417 12.575 186.15 13.6752 186.15 15.0324C186.15 16.3896 185.417 17.4898 184.512 17.4898Z\" fill=\"white\"/>\n      <path d=\"M196.828 24.4751C196.828 24.4751 195.16 28.3325 188.473 28.3325C183.469 28.3325 180.758 24.4751 180.758 24.4751\" stroke=\"white\" stroke-width=\"1.5\" stroke-miterlimit=\"10\" stroke-linecap=\"round\"/>\n    </g>\n    \n    <g class=\"mtx-survey-item\" data-value=\"5\">\n      <path d=\"M245.311 37.8048C255.319 37.8048 263.451 29.673 263.451 19.6646C263.451 9.65614 255.319 1.52429 245.311 1.52429C235.302 1.52429 227.171 9.65614 227.171 19.6646C227.171 29.673 235.302 37.8048 245.311 37.8048Z\" fill=\"#84C441\"/>\n      <path d=\"M245.311 2.64101C235.928 2.64101 228.288 10.2814 228.288 19.6643C228.288 29.0472 235.928 36.6875 245.311 36.6875C254.694 36.6875 262.334 29.0472 262.334 19.6643C262.334 10.2814 254.694 2.64101 245.311 2.64101ZM245.311 0.406982C255.945 0.406982 264.568 9.03031 264.568 19.6643C264.568 30.2982 255.945 38.9216 245.311 38.9216C234.677 38.9216 226.054 30.2982 226.054 19.6643C226.054 9.03031 234.677 0.406982 245.311 0.406982Z\" fill=\"#C9DF86\"/>\n      <path d=\"M249.717 17.4898C248.812 17.4898 248.079 16.3896 248.079 15.0324C248.079 13.6752 248.812 12.575 249.717 12.575C250.622 12.575 251.355 13.6752 251.355 15.0324C251.355 16.3896 250.622 17.4898 249.717 17.4898Z\" fill=\"white\"/>\n      <path d=\"M241.153 17.4898C240.248 17.4898 239.514 16.3896 239.514 15.0324C239.514 13.6752 240.248 12.575 241.153 12.575C242.058 12.575 242.791 13.6752 242.791 15.0324C242.791 16.3896 242.058 17.4898 241.153 17.4898Z\" fill=\"white\"/>\n      <path d=\"M254.602 22.4196C254.602 22.4196 252.799 29.0918 245.561 29.0918C238.829 29.0918 236.014 22.4196 236.014 22.4196\" stroke=\"white\" stroke-width=\"1.5\" stroke-miterlimit=\"10\" stroke-linecap=\"round\"/>\n    </g>\n  </svg>\n</div>\n<div class=\"mtx-survey-submit-holder\">\n  <button type=\"button\" class=\"mtx-survey-submit-button\" disabled>Submit</button>\n</div>`;\n\nconst SURVEY_SUCCESSFULLY_LOGGED = 'mtx-survey-successfully-logged';\n\nconst getSurveyLogs = () => {\n  const result = localStorage.getItem(SURVEY_SUCCESSFULLY_LOGGED);\n\n  if (result === null) {\n    return {};\n  }\n\n  return JSON.parse(result);\n};\n\nconst getIsSurveyLogged = (appkey: string) => {\n  const logs = getSurveyLogs();\n\n  return logs[appkey] !== undefined;\n};\n\nconst setSurveyLogged = (appkey: string, rating: number) => {\n  const logs = getSurveyLogs();\n\n  logs[appkey] = rating;\n\n  return localStorage.setItem(SURVEY_SUCCESSFULLY_LOGGED, JSON.stringify(logs));\n};\n\nlet surveyHolder = document.createElement('div');\n\nconst hideSurvey = (holder: ReturnType<Document['createElement']>) => {\n  holder.classList.add('mtx-survey--close');\n  setTimeout(() => document.body.removeChild(holder), 350);\n};\n\nexport const addSurvey = ({ appkey, sessionId, force = false, theme = 'white' }: AddSurveyProps) => {\n  hideSurvey(surveyHolder);\n  const isLogged = getIsSurveyLogged(appkey);\n\n  /** Don't show the survey twice in automatic mode */\n  if (isLogged && !force) {\n    return;\n  }\n\n  surveyHolder = document.createElement('div');\n  surveyHolder.setAttribute('class', `mtx-survey mtx-survey--${theme}`);\n  surveyHolder.innerHTML = template;\n  let rating: number | null = null;\n\n  document.body.appendChild(surveyHolder);\n\n  setTimeout(() => surveyHolder.classList.add('mtx-survey--open'), 0);\n\n  const items = [...surveyHolder.querySelectorAll('.mtx-survey-item')];\n  const submitButton = surveyHolder.querySelector('.mtx-survey-submit-button');\n\n  const setActiveItem = (item: Element) => {\n    items.forEach(itemScore => {\n      if (item !== itemScore) {\n        itemScore.setAttribute('style', 'opacity: 0.6');\n      } else {\n        itemScore.setAttribute('style', 'opacity: 1');\n      }\n    });\n  };\n\n  const handleItemClick = (item: Element) => {\n    item.addEventListener('click', () => {\n      rating = Number(item.getAttribute('data-value'));\n      submitButton?.removeAttribute('disabled');\n      setActiveItem(item);\n    });\n  };\n\n  items.forEach(handleItemClick);\n\n  submitButton?.addEventListener('click', async () => {\n    if (rating === null) {\n      return;\n    }\n\n    hideSurvey(surveyHolder);\n\n    try {\n      await sendMetricSurveysData({\n        appkey,\n        sessionId,\n        rating,\n      });\n\n      setSurveyLogged(appkey, rating);\n    } catch (e) {\n      console.log(e);\n    }\n  });\n};\n","import { API_ORIGIN, API_URL } from '../constants';\nimport { MetricSurveysData, XRAnalytics } from '../types';\n\nexport async function sendXRAnalyticsData(data: XRAnalytics.Record | XRAnalytics.BatchRecord) {\n  console.log('poll', data);\n\n  return fetch(`${API_URL}/xr-analytics`, {\n    method: 'POST',\n    keepalive: true,\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify(data),\n  });\n}\n\nexport async function sendMetricSurveysData(data: MetricSurveysData) {\n  console.log('survey data', data);\n\n  return fetch(`${API_ORIGIN}/api/v1/metric-surveys`, {\n    method: 'POST',\n    keepalive: true,\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify(data),\n  });\n}\n","import { generateUUID } from 'three/src/math/MathUtils';\nimport { sendXRAnalyticsData } from '../services';\nimport {\n  DEFAULT_INTERVAL_VALUE,\n  MAX_INTERVAL_VALUE,\n  MAXIMUM_BATCH_RECORDS_LENGTH,\n  MAXIMUM_BATCH_SENDING_INTERVAL,\n  MAXIMUM_SESSION_KEEPALIVE_TIME,\n  MIN_INTERVAL_VALUE,\n} from '../constants';\nimport { MetalitixLoggerOptions, SurveyTheme, XRAnalytics } from '../types';\nimport { deepEqual } from '../utils';\nimport { addSurvey } from './mtx-engagement-survey';\n\nexport default abstract class MetalitixLoggerBase<T> {\n  private appKey: string;\n  private apiVersion: string;\n  private interval: number = DEFAULT_INTERVAL_VALUE;\n  protected sessionId: string | null;\n  private pollRecords: XRAnalytics.Record[];\n  private lastPollTimestamp: number;\n  private nextPoll: number;\n  private pollInProgress: boolean;\n  private previousCameraData: XRAnalytics.UserCamera | null;\n  private customData: { [key: string]: any } = {};\n  private userMeta: Partial<XRAnalytics.UserMetadata>;\n  private showSurveyAutomatically: boolean;\n  private surveyTheme?: SurveyTheme;\n  private autoSurveyShowInMs: number;\n  private surveyTimer: number;\n  private prevFPSTime: number;\n  private frames: number;\n  private currentFPS: number;\n  protected object3D: T | null = null;\n\n  constructor(appKey: string, options: MetalitixLoggerOptions = {}) {\n    const {\n      pollInterval = DEFAULT_INTERVAL_VALUE,\n      apiVersion = 'v2',\n      userMeta = {},\n      showSurvey = false,\n      surveyTheme,\n    } = options;\n    this.appKey = appKey;\n    this.apiVersion = apiVersion;\n    this.userMeta = userMeta;\n    this.setPollInterval(pollInterval);\n    this.sessionId = null;\n    this.previousCameraData = null;\n    this.pollRecords = [];\n    this.lastPollTimestamp = -1;\n    this.pollInProgress = false;\n    this.nextPoll = -1;\n    this.pollInProgress = false;\n    this.showSurveyAutomatically = showSurvey;\n    this.surveyTheme = surveyTheme;\n    /** Show survey automatically in range between 30 seconds and 3 minutes */\n    this.autoSurveyShowInMs = (30 + 150 * Math.random()) * 1000;\n    this.surveyTimer = -1;\n    this.prevFPSTime = Date.now();\n    this.frames = 0;\n    this.currentFPS = 0;\n  }\n\n  public setPollInterval = (pollInterval: number) => {\n    this.interval = Math.min(MAX_INTERVAL_VALUE, Math.max(MIN_INTERVAL_VALUE, pollInterval));\n  };\n\n  /** Put this function in the `render` or `tick` function */\n  public updateFPS = () => {\n    this.frames++;\n\n    let time = Date.now();\n\n    if (time >= this.prevFPSTime + 1000) {\n      this.currentFPS = (this.frames * 1000) / (time - this.prevFPSTime);\n\n      this.prevFPSTime = time;\n      this.frames = 0;\n    }\n  };\n\n  public setCustomField = (key: string, value: any) => {\n    this.customData[key] = value;\n  };\n\n  public removeCustomField = (key: string) => {\n    delete this.customData[key];\n  };\n\n  private getRecord = (\n    eventType: XRAnalytics.EventTypes,\n    sessionId: string,\n    { userEvent, userMeta, camera, data }: XRAnalytics.RecordDataFields,\n  ) => {\n    const resultData = Object.assign({}, this.customData, data);\n\n    const base: XRAnalytics.RecordBase = {\n      object: 'xr.analytics.record',\n      appkey: this.appKey,\n      apiver: this.apiVersion,\n      sessionId,\n      timestamp: Date.now(),\n      metrics: {\n        fps: Math.round(this.currentFPS),\n      },\n      data: resultData,\n    };\n\n    if (eventType === XRAnalytics.EventTypes.SessionStart) {\n      console.assert(userMeta !== undefined, '\"userMeta\" is required for session start!');\n      console.assert(camera !== undefined, '\"camera\" is required for session start!');\n      return Object.assign({}, base, { eventType, userMeta, camera }) as XRAnalytics.SessionStartRecord;\n    }\n\n    if (eventType === XRAnalytics.EventTypes.SessionUpdate) {\n      console.assert(userMeta !== undefined, '\"userMeta\" is required for session update!');\n      return Object.assign({}, base, { eventType, userMeta, camera }) as XRAnalytics.SessionUpdateRecord;\n    }\n\n    if (eventType === XRAnalytics.EventTypes.SessionEnd) {\n      return Object.assign({}, base, { eventType, camera }) as XRAnalytics.SessionEndRecord;\n    }\n\n    if (eventType === XRAnalytics.EventTypes.UserPosition) {\n      return Object.assign({}, base, { eventType }) as XRAnalytics.UserPositionRecord;\n    }\n\n    if (eventType === XRAnalytics.EventTypes.UserInteraction) {\n      console.assert(userEvent !== undefined, '\"userEvent\" is required for user interaction!');\n      return Object.assign({}, base, { eventType, userEvent }) as XRAnalytics.UserInteractionRecord;\n    }\n\n    throw new Error('Unknown eventType: ' + eventType);\n  };\n\n  private addRecord = (\n    eventType: XRAnalytics.EventTypes,\n    { userEvent, userMeta, camera, data }: XRAnalytics.RecordDataFields,\n  ) => {\n    if (this.sessionId === null) {\n      return;\n    }\n\n    const record = this.getRecord(eventType, this.sessionId, { userEvent, userMeta, camera, data });\n\n    this.pollRecords.push(record);\n  };\n\n  private sendPosition = async (sendAll = false) => {\n    this.pollInProgress = true;\n\n    try {\n      const items = this.pollRecords.slice(0, MAXIMUM_BATCH_RECORDS_LENGTH);\n\n      const batchRecordsData = {\n        object: 'xr.analytics.batch.records',\n        appkey: this.appKey,\n        apiver: this.apiVersion,\n        items,\n      };\n\n      await sendXRAnalyticsData(batchRecordsData);\n      this.pollRecords = this.pollRecords.slice(MAXIMUM_BATCH_RECORDS_LENGTH);\n\n      if (this.pollRecords.length > 0 && sendAll) {\n        await this.sendPosition(true);\n      }\n\n      this.lastPollTimestamp = Date.now();\n    } catch (error) {\n      console.log('Something went wrong', error);\n      this.forceStopLoop();\n    } finally {\n      this.pollInProgress = false;\n    }\n  };\n\n  protected abstract getPositionData: (object3D: T | null) => XRAnalytics.Data | undefined;\n  protected abstract getCameraData: (object3D: T | null) => XRAnalytics.UserCamera | undefined;\n  protected abstract afterSessionStart: () => void;\n\n  private getUserMeta = (): Partial<XRAnalytics.UserMetadata> => {\n    return Object.assign({}, this.userMeta, {\n      userAgent: window.navigator.userAgent,\n      pagePath: location.pathname,\n      pageQuery: location.search,\n    });\n  };\n\n  private addSessionStart = () => {\n    const data = this.getPositionData(this.object3D);\n    const camera = this.getCameraData(this.object3D);\n    const userMeta = this.getUserMeta();\n    this.previousCameraData = camera || null;\n\n    if (data === undefined) {\n      return;\n    }\n\n    this.addRecord(XRAnalytics.EventTypes.SessionStart, { data, camera, userMeta });\n  };\n  private addSessionEnd = () => {\n    const data = this.getPositionData(this.object3D);\n    let camera = this.getCameraData(this.object3D);\n\n    if (data === undefined) {\n      return;\n    }\n\n    if (deepEqual(camera, this.previousCameraData)) {\n      /** Don't send the camera object if it was not changed */\n      camera = undefined;\n    }\n\n    this.addRecord(XRAnalytics.EventTypes.SessionEnd, { data, camera });\n  };\n  private addUserPosition = () => {\n    const data = this.getPositionData(this.object3D);\n\n    if (data === undefined) {\n      return;\n    }\n\n    this.addRecord(XRAnalytics.EventTypes.UserPosition, { data });\n  };\n  private addSessionUpdate = (camera?: XRAnalytics.UserCamera) => {\n    const data = this.getPositionData(this.object3D);\n    const userMeta = this.getUserMeta();\n\n    if (data === undefined) {\n      return;\n    }\n\n    this.addRecord(XRAnalytics.EventTypes.SessionUpdate, { data, camera, userMeta });\n  };\n\n  private sddNextUserPositionAndUpdateCameraIfNeeded = () => {\n    const camera = this.getCameraData(this.object3D);\n\n    if (camera === undefined || deepEqual(camera, this.previousCameraData)) {\n      this.addUserPosition();\n    } else {\n      this.addSessionUpdate(camera);\n      this.previousCameraData = camera;\n    }\n  };\n\n  private sendPositionLoop = (start = false) => {\n    /** Don't push position twice on session start */\n    if (!start) {\n      this.sddNextUserPositionAndUpdateCameraIfNeeded();\n    }\n\n    if (\n      !this.pollInProgress &&\n      this.pollRecords.length > 0 &&\n      (this.pollRecords.length >= MAXIMUM_BATCH_RECORDS_LENGTH ||\n        Date.now() - this.lastPollTimestamp >= MAXIMUM_BATCH_SENDING_INTERVAL)\n    ) {\n      this.sendPosition();\n    }\n\n    /** Stop polling data if session was ended and there is nothing to send */\n    if (this.sessionId === null && this.pollRecords.length === 0) {\n      return;\n    }\n\n    this.nextPoll = window.setTimeout(() => this.sendPositionLoop(), this.interval);\n  };\n\n  private forceStopLoop = () => clearTimeout(this.nextPoll);\n\n  private clearSessionPollRecords = () => {\n    this.pollRecords = [];\n  };\n\n  private handleVisibilityChange = async () => {\n    /**\n     *  If user close or switch the browser tab - we need to pause the session\n     *  Then if user came back to the browser - we need to try to resume the session if it's possible or start new one\n     **/\n    return document.visibilityState === 'hidden' ? this.pauseSession() : await this.resumeSession();\n  };\n\n  public startSession = (object3D: T) => {\n    this.object3D = object3D;\n    const sessionId = generateUUID();\n    this.sessionId = sessionId;\n    this.addSessionStart();\n    this.sendPositionLoop(true);\n    document.addEventListener('visibilitychange', this.handleVisibilityChange);\n    this.afterSessionStart();\n\n    if (this.showSurveyAutomatically) {\n      this.surveyTimer = window.setTimeout(\n        () => addSurvey({ appkey: this.appKey, sessionId, theme: this.surveyTheme }),\n        this.autoSurveyShowInMs,\n      );\n    }\n  };\n\n  public pauseSession = () => {\n    /** If the session was paused we need to send all our data and stop collecting new items */\n    this.forceStopLoop();\n    return this.sendPosition(true);\n  };\n\n  public resumeSession = async () => {\n    if (this.lastPollTimestamp < 0 || Date.now() - this.lastPollTimestamp <= MAXIMUM_SESSION_KEEPALIVE_TIME) {\n      /** If the session was resumed on time - we need to continue collect current session data */\n      this.forceStopLoop(); // in case if session was not paused\n      this.sendPositionLoop();\n    } else if (this.object3D !== null) {\n      /** If the session was resumed when server already has closed the session - we need to start new session */\n      const object3D = this.object3D;\n      await this.endSession();\n      this.startSession(object3D);\n    }\n  };\n\n  public endSession = async () => {\n    if (this.sessionId === null) {\n      /** The session was already ended */\n      return;\n    }\n\n    this.addSessionEnd();\n    this.object3D = null;\n    this.sessionId = null;\n    this.previousCameraData = null;\n    this.forceStopLoop();\n    await this.sendPosition(true);\n    this.clearSessionPollRecords();\n    this.lastPollTimestamp = -1;\n    document.removeEventListener('visibilitychange', this.handleVisibilityChange);\n  };\n\n  public updateUserMeta = (userMeta: Partial<XRAnalytics.UserMetadata>) => {\n    if (userMeta === undefined) {\n      return;\n    }\n\n    this.userMeta = userMeta;\n\n    this.addSessionUpdate();\n  };\n\n  private sendUserEvent = (\n    eventName: string,\n    eventType: XRAnalytics.UserInteractionTypes | string,\n    target?: string | XRAnalytics.EventPoint | any,\n    points?: XRAnalytics.EventPoint[],\n    params?: object,\n  ) => {\n    const data = this.getPositionData(this.object3D);\n    const userEvent: XRAnalytics.UserEvent = {\n      object: 'user.event',\n      eventName,\n      eventType,\n      target,\n      points,\n      params,\n    };\n\n    if (data === undefined) {\n      return;\n    }\n\n    this.addRecord(XRAnalytics.EventTypes.UserInteraction, { data, userEvent });\n  };\n\n  public logCustomEvent = (eventName: string, params: object) => {\n    this.sendUserEvent(eventName, 'custom', undefined, undefined, params);\n  };\n\n  public logKeyDownEvent = (x: number, y: number, params?: object) => {\n    this.sendUserEvent(\n      'key_down',\n      XRAnalytics.UserInteractionTypes.KeyDown,\n      {\n        state: XRAnalytics.PointStates.Pressed,\n        timestamp: Date.now(),\n        position: { x, y },\n      },\n      undefined,\n      params,\n    );\n  };\n\n  public logKeyPressEvent = (x: number, y: number, params?: object) => {\n    this.sendUserEvent(\n      'key_press',\n      XRAnalytics.UserInteractionTypes.KeyPress,\n      {\n        state: XRAnalytics.PointStates.Stationary,\n        timestamp: Date.now(),\n        position: { x, y },\n      },\n      undefined,\n      params,\n    );\n  };\n\n  public logKeyUpEvent = (x: number, y: number, params?: object) => {\n    this.sendUserEvent(\n      'key_up',\n      XRAnalytics.UserInteractionTypes.KeyUp,\n      {\n        state: XRAnalytics.PointStates.Released,\n        timestamp: Date.now(),\n        position: { x, y },\n      },\n      undefined,\n      params,\n    );\n  };\n\n  public logMouseEnterEvent = (x: number, y: number, params?: object) => {\n    this.sendUserEvent(\n      'mouse_enter',\n      XRAnalytics.UserInteractionTypes.MouseEnter,\n      {\n        state: XRAnalytics.PointStates.Stationary,\n        timestamp: Date.now(),\n        position: { x, y },\n      },\n      undefined,\n      params,\n    );\n  };\n\n  public logMouseLeaveEvent = (x: number, y: number, params?: object) => {\n    this.sendUserEvent(\n      'mouse_leave',\n      XRAnalytics.UserInteractionTypes.MouseLeave,\n      {\n        state: XRAnalytics.PointStates.Stationary,\n        timestamp: Date.now(),\n        position: { x, y },\n      },\n      undefined,\n      params,\n    );\n  };\n\n  public logMouseOverEvent = (x: number, y: number, params?: object) => {\n    this.sendUserEvent(\n      'mouse_over',\n      XRAnalytics.UserInteractionTypes.MouseOver,\n      {\n        state: XRAnalytics.PointStates.Stationary,\n        timestamp: Date.now(),\n        position: { x, y },\n      },\n      undefined,\n      params,\n    );\n  };\n\n  public logMouseOutEvent = (x: number, y: number, params?: object) => {\n    this.sendUserEvent(\n      'mouse_out',\n      XRAnalytics.UserInteractionTypes.MouseOut,\n      {\n        state: XRAnalytics.PointStates.Stationary,\n        timestamp: Date.now(),\n        position: { x, y },\n      },\n      undefined,\n      params,\n    );\n  };\n\n  public logMouseDownEvent = (x: number, y: number, params?: object) => {\n    this.sendUserEvent(\n      'mouse_down',\n      XRAnalytics.UserInteractionTypes.MouseDown,\n      {\n        state: XRAnalytics.PointStates.Pressed,\n        timestamp: Date.now(),\n        position: { x, y },\n      },\n      undefined,\n      params,\n    );\n  };\n\n  public logMouseUpEvent = (x: number, y: number, params?: object) => {\n    this.sendUserEvent(\n      'mouse_up',\n      XRAnalytics.UserInteractionTypes.MouseUp,\n      {\n        state: XRAnalytics.PointStates.Released,\n        timestamp: Date.now(),\n        position: { x, y },\n      },\n      undefined,\n      params,\n    );\n  };\n\n  public logMouseMoveEvent = (x: number, y: number, params?: object) => {\n    this.sendUserEvent(\n      'mouse_move',\n      XRAnalytics.UserInteractionTypes.MouseMove,\n      {\n        state: XRAnalytics.PointStates.Updated,\n        timestamp: Date.now(),\n        position: { x, y },\n      },\n      undefined,\n      params,\n    );\n  };\n\n  public logMousePressEvent = (x: number, y: number, params?: object) => {\n    this.sendUserEvent(\n      'mouse_press',\n      XRAnalytics.UserInteractionTypes.MousePress,\n      {\n        state: XRAnalytics.PointStates.Stationary,\n        timestamp: Date.now(),\n        position: { x, y },\n      },\n      undefined,\n      params,\n    );\n  };\n\n  public logTouchTapEvent = (x: number, y: number, params?: object) => {\n    this.sendUserEvent(\n      'touch_tap',\n      XRAnalytics.UserInteractionTypes.TouchTap,\n      {\n        state: XRAnalytics.PointStates.Stationary,\n        timestamp: Date.now(),\n        position: { x, y },\n      },\n      undefined,\n      params,\n    );\n  };\n\n  public logTouchStartEvent = (x: number, y: number, params?: object) => {\n    this.sendUserEvent(\n      'touch_start',\n      XRAnalytics.UserInteractionTypes.TouchStart,\n      {\n        state: XRAnalytics.PointStates.Pressed,\n        timestamp: Date.now(),\n        position: { x, y },\n      },\n      undefined,\n      params,\n    );\n  };\n\n  public logTouchMoveEvent = (x: number, y: number, params?: object) => {\n    this.sendUserEvent(\n      'touch_move',\n      XRAnalytics.UserInteractionTypes.TouchMove,\n      {\n        state: XRAnalytics.PointStates.Updated,\n        timestamp: Date.now(),\n        position: { x, y },\n      },\n      undefined,\n      params,\n    );\n  };\n\n  public logTouchEndEvent = (x: number, y: number, params?: object) => {\n    this.sendUserEvent(\n      'touch_end',\n      XRAnalytics.UserInteractionTypes.TouchEnd,\n      {\n        state: XRAnalytics.PointStates.Released,\n        timestamp: Date.now(),\n        position: { x, y },\n      },\n      undefined,\n      params,\n    );\n  };\n\n  public logZoomStartEvent = (x: number, y: number, params?: object) => {\n    this.sendUserEvent(\n      'zoom_start',\n      XRAnalytics.UserInteractionTypes.ZoomStart,\n      {\n        state: XRAnalytics.PointStates.Pressed,\n        timestamp: Date.now(),\n        position: { x, y },\n      },\n      undefined,\n      params,\n    );\n  };\n\n  public logZoomUpdateEvent = (x: number, y: number, params?: object) => {\n    this.sendUserEvent(\n      'zoom_update',\n      XRAnalytics.UserInteractionTypes.ZoomUpdate,\n      {\n        state: XRAnalytics.PointStates.Updated,\n        timestamp: Date.now(),\n        position: { x, y },\n      },\n      undefined,\n      params,\n    );\n  };\n\n  public logZoomEndEvent = (x: number, y: number, params?: object) => {\n    this.sendUserEvent(\n      'zoom_end',\n      XRAnalytics.UserInteractionTypes.ZoomEnd,\n      {\n        state: XRAnalytics.PointStates.Released,\n        timestamp: Date.now(),\n        position: { x, y },\n      },\n      undefined,\n      params,\n    );\n  };\n\n  public showSurvey = (surveyTheme?: SurveyTheme) => {\n    clearTimeout(this.surveyTimer);\n\n    if (this.sessionId === null) {\n      return;\n    }\n\n    addSurvey({ appkey: this.appKey, sessionId: this.sessionId, theme: surveyTheme ?? this.surveyTheme, force: true });\n  };\n}\n","import { Scene } from 'babylonjs';\nimport { MetalitixLoggerOptions } from '../types';\nimport MetalitixLoggerBase from './mtx-poll-base';\n\nexport default class MetalitixLogger extends MetalitixLoggerBase<Scene> {\n  constructor(appKey: string, options: MetalitixLoggerOptions = {}) {\n    super(appKey, options);\n  }\n\n  protected afterSessionStart = () => {};\n\n  protected getPositionData = (scene: Scene | null) => {\n    const camera = scene?.activeCamera ?? null;\n    if (camera === null) {\n      return undefined;\n    }\n\n    return {\n      position: { x: camera.position.x, y: camera.position.y, z: camera.position.z },\n      direction: { x: camera.absoluteRotation.x, y: camera.absoluteRotation.y, z: camera.absoluteRotation.z },\n    };\n  };\n\n  protected getCameraData = (scene: Scene | null) => {\n    const camera = scene?.activeCamera ?? null;\n    if (camera === null) {\n      return undefined;\n    }\n\n    return {\n      fieldOfView: camera.fov,\n      aspectRatio: camera.viewport.width / camera.viewport.height,\n      zNearPlane: camera.minZ,\n      zFarPlane: camera.maxZ,\n    };\n  };\n}\n"],"names":["root","factory","exports","module","define","amd","self","__webpack_require__","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","_lut","i","toString","Math","PI","API_ORIGIN","API_URL","DEFAULT_INTERVAL_VALUE","XRAnalytics","deepEqual","x","y","ok","keys","tx","length","every","PointStates","UserInteractionTypes","EventTypes","KnownPointStates","values","KnownUserInteractionTypes","KnownEventTypes","SURVEY_SUCCESSFULLY_LOGGED","getSurveyLogs","result","localStorage","getItem","JSON","parse","surveyHolder","document","createElement","hideSurvey","holder","classList","add","setTimeout","body","removeChild","addSurvey","appkey","sessionId","force","theme","isLogged","undefined","getIsSurveyLogged","setAttribute","innerHTML","rating","appendChild","items","querySelectorAll","submitButton","querySelector","forEach","item","addEventListener","Number","getAttribute","removeAttribute","itemScore","setActiveItem","data","console","log","fetch","method","keepalive","headers","stringify","sendMetricSurveysData","logs","setItem","setSurveyLogged","e","MetalitixLoggerBase","constructor","appKey","options","interval","customData","object3D","setPollInterval","pollInterval","this","min","max","updateFPS","frames","time","Date","now","prevFPSTime","currentFPS","setCustomField","value","removeCustomField","getRecord","eventType","userEvent","userMeta","camera","resultData","assign","base","object","apiver","apiVersion","timestamp","metrics","fps","round","SessionStart","assert","SessionUpdate","SessionEnd","UserPosition","UserInteraction","Error","addRecord","record","pollRecords","push","sendPosition","sendAll","pollInProgress","slice","batchRecordsData","sendXRAnalyticsData","lastPollTimestamp","error","forceStopLoop","getUserMeta","userAgent","window","navigator","pagePath","location","pathname","pageQuery","search","addSessionStart","getPositionData","getCameraData","previousCameraData","addSessionEnd","addUserPosition","addSessionUpdate","sddNextUserPositionAndUpdateCameraIfNeeded","sendPositionLoop","start","nextPoll","clearTimeout","clearSessionPollRecords","handleVisibilityChange","visibilityState","pauseSession","resumeSession","startSession","d0","random","d1","d2","d3","toUpperCase","generateUUID","afterSessionStart","showSurveyAutomatically","surveyTimer","surveyTheme","autoSurveyShowInMs","endSession","removeEventListener","updateUserMeta","sendUserEvent","eventName","target","points","params","logCustomEvent","logKeyDownEvent","KeyDown","state","Pressed","position","logKeyPressEvent","KeyPress","Stationary","logKeyUpEvent","KeyUp","Released","logMouseEnterEvent","MouseEnter","logMouseLeaveEvent","MouseLeave","logMouseOverEvent","MouseOver","logMouseOutEvent","MouseOut","logMouseDownEvent","MouseDown","logMouseUpEvent","MouseUp","logMouseMoveEvent","MouseMove","Updated","logMousePressEvent","MousePress","logTouchTapEvent","TouchTap","logTouchStartEvent","TouchStart","logTouchMoveEvent","TouchMove","logTouchEndEvent","TouchEnd","logZoomStartEvent","ZoomStart","logZoomUpdateEvent","ZoomUpdate","logZoomEndEvent","ZoomEnd","showSurvey","MetalitixLogger","super","scene","activeCamera","z","direction","absoluteRotation","fieldOfView","fov","aspectRatio","viewport","width","height","zNearPlane","minZ","zFarPlane","maxZ"],"sourceRoot":""}