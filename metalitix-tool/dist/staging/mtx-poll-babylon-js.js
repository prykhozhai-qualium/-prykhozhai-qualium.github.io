!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.MetalitixLogger=e():t.MetalitixLogger=e()}(self,(()=>(()=>{"use strict";var t=[,(t,e,s)=>{s.r(e),s.d(e,{default:()=>d});var o=s(6),n=s(2),i=s(3),a=s(4),r=s(5),c=function(t,e,s,o){return new(s||(s=Promise))((function(n,i){function a(t){try{c(o.next(t))}catch(t){i(t)}}function r(t){try{c(o.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(a,r)}c((o=o.apply(t,e||[])).next())}))};class d{constructor(t,e={}){this.interval=i.DEFAULT_INTERVAL_VALUE,this.customData={},this.object3D=null,this.setPollInterval=t=>{this.interval=Math.min(i.MAX_INTERVAL_VALUE,Math.max(i.MIN_INTERVAL_VALUE,t))},this.setCustomField=(t,e)=>{this.customData[t]=e},this.removeCustomField=t=>{delete this.customData[t]},this.getRecord=(t,e,{userEvent:s,userMeta:o,camera:n,data:i})=>{const r=Object.assign({},this.customData,i),c={object:"xr.analytics.record",appkey:this.appKey,apiver:this.apiVersion,sessionId:e,timestamp:Date.now(),data:r};if(t===a.XRAnalytics.EventTypes.SessionStart)return console.assert(void 0!==o,'"userMeta" is required for session start!'),console.assert(void 0!==n,'"camera" is required for session start!'),Object.assign({},c,{eventType:t,userMeta:o,camera:n});if(t===a.XRAnalytics.EventTypes.SessionUpdate)return console.assert(void 0!==o,'"userMeta" is required for session update!'),Object.assign({},c,{eventType:t,userMeta:o,camera:n});if(t===a.XRAnalytics.EventTypes.SessionEnd)return Object.assign({},c,{eventType:t,camera:n});if(t===a.XRAnalytics.EventTypes.UserPosition)return Object.assign({},c,{eventType:t});if(t===a.XRAnalytics.EventTypes.UserInteraction)return console.assert(void 0!==s,'"userEvent" is required for user interaction!'),Object.assign({},c,{eventType:t,userEvent:s});throw new Error("Unknown eventType: "+t)},this.addRecord=(t,{userEvent:e,userMeta:s,camera:o,data:n})=>{if(null===this.sessionId)return;const i=this.getRecord(t,this.sessionId,{userEvent:e,userMeta:s,camera:o,data:n});this.pollRecords.push(i)},this.sendPosition=(t=!1)=>c(this,void 0,void 0,(function*(){this.pollInProgress=!0;try{const e=this.pollRecords.slice(0,i.MAXIMUM_BATCH_RECORDS_LENGTH),s={object:"xr.analytics.batch.records",appkey:this.appKey,apiver:this.apiVersion,items:e};yield(0,n.sendXRAnalyticsData)(s),this.pollRecords=this.pollRecords.slice(i.MAXIMUM_BATCH_RECORDS_LENGTH),this.pollRecords.length>0&&t&&(yield this.sendPosition(!0)),this.lastPollTimestamp=Date.now()}catch(t){console.log("Something went wrong",t),this.forceStopLoop()}finally{this.pollInProgress=!1}})),this.getUserMeta=()=>Object.assign({},this.userMeta,{userAgent:window.navigator.userAgent,pagePath:location.pathname,pageQuery:location.search}),this.addSessionStart=()=>{const t=this.getPositionData(this.object3D),e=this.getCameraData(this.object3D),s=this.getUserMeta();this.previousCameraData=e||null,void 0!==t&&this.addRecord(a.XRAnalytics.EventTypes.SessionStart,{data:t,camera:e,userMeta:s})},this.addSessionEnd=()=>{const t=this.getPositionData(this.object3D);let e=this.getCameraData(this.object3D);void 0!==t&&((0,r.deepEqual)(e,this.previousCameraData)&&(e=void 0),this.addRecord(a.XRAnalytics.EventTypes.SessionEnd,{data:t,camera:e}))},this.addUserPosition=()=>{const t=this.getPositionData(this.object3D);void 0!==t&&this.addRecord(a.XRAnalytics.EventTypes.UserPosition,{data:t})},this.addSessionUpdate=t=>{const e=this.getPositionData(this.object3D),s=this.getUserMeta();void 0!==e&&this.addRecord(a.XRAnalytics.EventTypes.SessionUpdate,{data:e,camera:t,userMeta:s})},this.sddNextUserPositionAndUpdateCameraIfNeeded=()=>{const t=this.getCameraData(this.object3D);void 0===t||(0,r.deepEqual)(t,this.previousCameraData)?this.addUserPosition():(this.addSessionUpdate(t),this.previousCameraData=t)},this.sendPositionLoop=(t=!1)=>{t||this.sddNextUserPositionAndUpdateCameraIfNeeded(),!this.pollInProgress&&this.pollRecords.length>0&&(this.pollRecords.length>=i.MAXIMUM_BATCH_RECORDS_LENGTH||Date.now()-this.lastPollTimestamp>=i.MAXIMUM_BATCH_SENDING_INTERVAL)&&this.sendPosition(),null===this.sessionId&&0===this.pollRecords.length||(this.nextPoll=window.setTimeout((()=>this.sendPositionLoop()),this.interval))},this.forceStopLoop=()=>clearTimeout(this.nextPoll),this.clearSessionPollRecords=()=>{this.pollRecords=[]},this.handleVisibilityChange=()=>c(this,void 0,void 0,(function*(){return"hidden"===document.visibilityState?this.pauseSession():yield this.resumeSession()})),this.startSession=t=>{this.object3D=t,this.sessionId=(0,o.generateUUID)(),this.addSessionStart(),this.sendPositionLoop(!0),document.addEventListener("visibilitychange",this.handleVisibilityChange)},this.pauseSession=()=>(this.forceStopLoop(),this.sendPosition(!0)),this.resumeSession=()=>c(this,void 0,void 0,(function*(){if(this.lastPollTimestamp<0||Date.now()-this.lastPollTimestamp<=i.MAXIMUM_SESSION_KEEPALIVE_TIME)this.forceStopLoop(),this.sendPositionLoop();else if(null!==this.object3D){const t=this.object3D;yield this.endSession(),this.startSession(t)}})),this.endSession=()=>c(this,void 0,void 0,(function*(){null!==this.sessionId&&(this.addSessionEnd(),this.object3D=null,this.sessionId=null,this.previousCameraData=null,this.forceStopLoop(),yield this.sendPosition(!0),this.clearSessionPollRecords(),this.lastPollTimestamp=-1,document.removeEventListener("visibilitychange",this.handleVisibilityChange))})),this.updateUserMeta=t=>{void 0!==t&&(this.userMeta=t,this.addSessionUpdate())},this.sendUserEvent=(t,e,s,o,n)=>{const i=this.getPositionData(this.object3D),r={object:"user.event",eventName:t,eventType:e,target:s,points:o,params:n};void 0!==i&&this.addRecord(a.XRAnalytics.EventTypes.UserInteraction,{data:i,userEvent:r})},this.logCustomEvent=(t,e)=>{this.sendUserEvent(t,"custom",void 0,void 0,e)},this.logKeyDownEvent=(t,e,s)=>{this.sendUserEvent("key_down",a.XRAnalytics.UserInteractionTypes.KeyDown,{state:a.XRAnalytics.PointStates.Pressed,timestamp:Date.now(),position:{x:t,y:e}},void 0,s)},this.logKeyPressEvent=(t,e,s)=>{this.sendUserEvent("key_press",a.XRAnalytics.UserInteractionTypes.KeyPress,{state:a.XRAnalytics.PointStates.Stationary,timestamp:Date.now(),position:{x:t,y:e}},void 0,s)},this.logKeyUpEvent=(t,e,s)=>{this.sendUserEvent("key_up",a.XRAnalytics.UserInteractionTypes.KeyUp,{state:a.XRAnalytics.PointStates.Released,timestamp:Date.now(),position:{x:t,y:e}},void 0,s)},this.logMouseEnterEvent=(t,e,s)=>{this.sendUserEvent("mouse_enter",a.XRAnalytics.UserInteractionTypes.MouseEnter,{state:a.XRAnalytics.PointStates.Stationary,timestamp:Date.now(),position:{x:t,y:e}},void 0,s)},this.logMouseLeaveEvent=(t,e,s)=>{this.sendUserEvent("mouse_leave",a.XRAnalytics.UserInteractionTypes.MouseLeave,{state:a.XRAnalytics.PointStates.Stationary,timestamp:Date.now(),position:{x:t,y:e}},void 0,s)},this.logMouseOverEvent=(t,e,s)=>{this.sendUserEvent("mouse_over",a.XRAnalytics.UserInteractionTypes.MouseOver,{state:a.XRAnalytics.PointStates.Stationary,timestamp:Date.now(),position:{x:t,y:e}},void 0,s)},this.logMouseOutEvent=(t,e,s)=>{this.sendUserEvent("mouse_out",a.XRAnalytics.UserInteractionTypes.MouseOut,{state:a.XRAnalytics.PointStates.Stationary,timestamp:Date.now(),position:{x:t,y:e}},void 0,s)},this.logMouseDownEvent=(t,e,s)=>{this.sendUserEvent("mouse_down",a.XRAnalytics.UserInteractionTypes.MouseDown,{state:a.XRAnalytics.PointStates.Pressed,timestamp:Date.now(),position:{x:t,y:e}},void 0,s)},this.logMouseUpEvent=(t,e,s)=>{this.sendUserEvent("mouse_up",a.XRAnalytics.UserInteractionTypes.MouseUp,{state:a.XRAnalytics.PointStates.Released,timestamp:Date.now(),position:{x:t,y:e}},void 0,s)},this.logMouseMoveEvent=(t,e,s)=>{this.sendUserEvent("mouse_move",a.XRAnalytics.UserInteractionTypes.MouseMove,{state:a.XRAnalytics.PointStates.Updated,timestamp:Date.now(),position:{x:t,y:e}},void 0,s)},this.logMousePressEvent=(t,e,s)=>{this.sendUserEvent("mouse_press",a.XRAnalytics.UserInteractionTypes.MousePress,{state:a.XRAnalytics.PointStates.Stationary,timestamp:Date.now(),position:{x:t,y:e}},void 0,s)},this.logTouchTapEvent=(t,e,s)=>{this.sendUserEvent("touch_tap",a.XRAnalytics.UserInteractionTypes.TouchTap,{state:a.XRAnalytics.PointStates.Stationary,timestamp:Date.now(),position:{x:t,y:e}},void 0,s)},this.logTouchStartEvent=(t,e,s)=>{this.sendUserEvent("touch_start",a.XRAnalytics.UserInteractionTypes.TouchStart,{state:a.XRAnalytics.PointStates.Pressed,timestamp:Date.now(),position:{x:t,y:e}},void 0,s)},this.logTouchMoveEvent=(t,e,s)=>{this.sendUserEvent("touch_move",a.XRAnalytics.UserInteractionTypes.TouchMove,{state:a.XRAnalytics.PointStates.Updated,timestamp:Date.now(),position:{x:t,y:e}},void 0,s)},this.logTouchEndEvent=(t,e,s)=>{this.sendUserEvent("touch_end",a.XRAnalytics.UserInteractionTypes.TouchEnd,{state:a.XRAnalytics.PointStates.Released,timestamp:Date.now(),position:{x:t,y:e}},void 0,s)},this.logZoomStartEvent=(t,e,s)=>{this.sendUserEvent("zoom_start",a.XRAnalytics.UserInteractionTypes.ZoomStart,{state:a.XRAnalytics.PointStates.Pressed,timestamp:Date.now(),position:{x:t,y:e}},void 0,s)},this.logZoomUpdateEvent=(t,e,s)=>{this.sendUserEvent("zoom_update",a.XRAnalytics.UserInteractionTypes.ZoomUpdate,{state:a.XRAnalytics.PointStates.Updated,timestamp:Date.now(),position:{x:t,y:e}},void 0,s)},this.logZoomEndEvent=(t,e,s)=>{this.sendUserEvent("zoom_end",a.XRAnalytics.UserInteractionTypes.ZoomEnd,{state:a.XRAnalytics.PointStates.Released,timestamp:Date.now(),position:{x:t,y:e}},void 0,s)};const{pollInterval:s=i.DEFAULT_INTERVAL_VALUE,apiVersion:d="v2",userMeta:l={}}=e;this.appKey=t,this.apiVersion=d,this.userMeta=l,this.setPollInterval(s),this.sessionId=null,this.previousCameraData=null,this.pollRecords=[],this.lastPollTimestamp=-1,this.pollInProgress=!1,this.nextPoll=-1}}},(t,e,s)=>{s.r(e),s.d(e,{sendXRAnalyticsData:()=>n});var o=s(3);function n(t){return e=this,s=void 0,i=function*(){return console.log("poll",t),fetch(`${o.API_URL}/xr-analytics`,{method:"POST",keepalive:!0,headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})},new((n=void 0)||(n=Promise))((function(t,o){function a(t){try{c(i.next(t))}catch(t){o(t)}}function r(t){try{c(i.throw(t))}catch(t){o(t)}}function c(e){var s;e.done?t(e.value):(s=e.value,s instanceof n?s:new n((function(t){t(s)}))).then(a,r)}c((i=i.apply(e,s||[])).next())}));var e,s,n,i}},(t,e,s)=>{s.r(e),s.d(e,{API_ORIGIN:()=>i,API_URL:()=>r,API_VERSION:()=>a,DEFAULT_INTERVAL_VALUE:()=>l,MAXIMUM_BATCH_RECORDS_LENGTH:()=>u,MAXIMUM_BATCH_SENDING_INTERVAL:()=>h,MAXIMUM_SESSION_KEEPALIVE_TIME:()=>p,MAX_INTERVAL_VALUE:()=>d,MIN_INTERVAL_VALUE:()=>c,isProduction:()=>o,isStaging:()=>n});const o=!1,n=!0,i=o?"https://app.metalitix.com":n?"https://metalitix-staging.aircards.io":"https://metalitix-dev.aircards.io",a="v1",r=`${i}/api/${a}`,c=100,d=1e3,l=500,u=100,h=18e4,p=3e5},(t,e,s)=>{var o;s.r(e),s.d(e,{XRAnalytics:()=>o}),function(t){let e,s,o;!function(t){t.Pressed="state.pressed",t.Updated="state.updated",t.Released="state.released",t.Stationary="state.stationary"}(e=t.PointStates||(t.PointStates={})),t.KnownPointStates=Object.values(e),function(t){t.KeyDown="user.interaction.key_down",t.KeyPress="user.interaction.key_press",t.KeyUp="user.interaction.key_down",t.MouseEnter="user.interaction.mouse_enter",t.MouseLeave="user.interaction.mouse_leave",t.MouseOver="user.interaction.mouse_over",t.MouseOut="user.interaction.mouse_out",t.MouseDown="user.interaction.mouse_down",t.MouseUp="user.interaction.mouse_up",t.MouseMove="user.interaction.mouse_move",t.MousePress="user.interaction.mouse_press",t.TouchTap="user.interaction.touch_tap",t.TouchStart="user.interaction.touch_start",t.TouchMove="user.interaction.touch_move",t.TouchEnd="user.interaction.touch_end",t.ZoomStart="user.interaction.zoom_start",t.ZoomUpdate="user.interaction.zoom_update",t.ZoomEnd="user.interaction.zoom_end"}(s=t.UserInteractionTypes||(t.UserInteractionTypes={})),t.KnownUserInteractionTypes=Object.values(s),function(t){t.UserPosition="event.user.position",t.UserInteraction="event.user.interaction",t.SessionStart="event.session.start",t.SessionUpdate="event.session.update",t.SessionEnd="event.session.end"}(o=t.EventTypes||(t.EventTypes={})),t.KnownEventTypes=Object.values(o)}(o||(o={}))},(t,e,s)=>{function o(t,e){const s=Object.keys,n=typeof t;return t&&e&&"object"===n&&n===typeof e?s(t).length===s(e).length&&s(t).every((s=>o(t[s],e[s]))):t===e}function n(t){return t&&"object"==typeof t&&!Array.isArray(t)}function i(t,e){let s=Object.assign({},t);return n(t)&&n(e)&&Object.keys(e).forEach((o=>{n(e[o])?o in t?s[o]=i(t[o],e[o]):Object.assign(s,{[o]:e[o]}):Object.assign(s,{[o]:e[o]})})),s}s.r(e),s.d(e,{deepEqual:()=>o,isObject:()=>n,mergeDeep:()=>i})},(t,e,s)=>{s.r(e),s.d(e,{DEG2RAD:()=>i,RAD2DEG:()=>a,ceilPowerOfTwo:()=>S,clamp:()=>c,damp:()=>p,degToRad:()=>U,euclideanModulo:()=>d,floorPowerOfTwo:()=>P,generateUUID:()=>r,inverseLerp:()=>u,isPowerOfTwo:()=>T,lerp:()=>h,mapLinear:()=>l,pingpong:()=>v,radToDeg:()=>A,randFloat:()=>M,randFloatSpread:()=>f,randInt:()=>E,seededRandom:()=>R,setQuaternionFromProperEuler:()=>g,smootherstep:()=>m,smoothstep:()=>y});const o=[];for(let t=0;t<256;t++)o[t]=(t<16?"0":"")+t.toString(16);let n=1234567;const i=Math.PI/180,a=180/Math.PI;function r(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,s=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(o[255&t]+o[t>>8&255]+o[t>>16&255]+o[t>>24&255]+"-"+o[255&e]+o[e>>8&255]+"-"+o[e>>16&15|64]+o[e>>24&255]+"-"+o[63&s|128]+o[s>>8&255]+"-"+o[s>>16&255]+o[s>>24&255]+o[255&n]+o[n>>8&255]+o[n>>16&255]+o[n>>24&255]).toUpperCase()}function c(t,e,s){return Math.max(e,Math.min(s,t))}function d(t,e){return(t%e+e)%e}function l(t,e,s,o,n){return o+(t-e)*(n-o)/(s-e)}function u(t,e,s){return t!==e?(s-t)/(e-t):0}function h(t,e,s){return(1-s)*t+s*e}function p(t,e,s,o){return h(t,e,1-Math.exp(-s*o))}function v(t,e=1){return e-Math.abs(d(t,2*e)-e)}function y(t,e,s){return t<=e?0:t>=s?1:(t=(t-e)/(s-e))*t*(3-2*t)}function m(t,e,s){return t<=e?0:t>=s?1:(t=(t-e)/(s-e))*t*t*(t*(6*t-15)+10)}function E(t,e){return t+Math.floor(Math.random()*(e-t+1))}function M(t,e){return t+Math.random()*(e-t)}function f(t){return t*(.5-Math.random())}function R(t){return void 0!==t&&(n=t%2147483647),n=16807*n%2147483647,(n-1)/2147483646}function U(t){return t*i}function A(t){return t*a}function T(t){return 0==(t&t-1)&&0!==t}function S(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function P(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function g(t,e,s,o,n){const i=Math.cos,a=Math.sin,r=i(s/2),c=a(s/2),d=i((e+o)/2),l=a((e+o)/2),u=i((e-o)/2),h=a((e-o)/2),p=i((o-e)/2),v=a((o-e)/2);switch(n){case"XYX":t.set(r*l,c*u,c*h,r*d);break;case"YZY":t.set(c*h,r*l,c*u,r*d);break;case"ZXZ":t.set(c*u,c*h,r*l,r*d);break;case"XZX":t.set(r*l,c*v,c*p,r*d);break;case"YXY":t.set(c*p,r*l,c*v,r*d);break;case"ZYZ":t.set(c*v,c*p,r*l,r*d);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+n)}}}],e={};function s(o){var n=e[o];if(void 0!==n)return n.exports;var i=e[o]={exports:{}};return t[o](i,i.exports,s),i.exports}s.d=(t,e)=>{for(var o in e)s.o(e,o)&&!s.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),s.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var o={};return(()=>{s.r(o),s.d(o,{default:()=>e});var t=s(1);class e extends t.default{constructor(t,e={}){super(t,e),this.getPositionData=t=>{var e;const s=null!==(e=null==t?void 0:t.activeCamera)&&void 0!==e?e:null;if(null!==s)return{position:{x:s.position.x,y:s.position.y,z:s.position.z},direction:{x:s.absoluteRotation.x,y:s.absoluteRotation.y,z:s.absoluteRotation.z}}},this.getCameraData=t=>{var e;const s=null!==(e=null==t?void 0:t.activeCamera)&&void 0!==e?e:null;if(null!==s)return{fieldOfView:s.fov,aspectRatio:s.viewport.width/s.viewport.height,zNearPlane:s.minZ,zFarPlane:s.maxZ}}}}})(),o.default})()));
//# sourceMappingURL=mtx-poll-babylon-js.js.map